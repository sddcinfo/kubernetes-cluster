terraform {
  required_providers {
    proxmox = {
      source  = "bpg/proxmox"
      version = "~> 0.68"
    }
  }
}

provider "proxmox" {
  endpoint = "https://10.10.1.21:8006/"
  api_token = "packer@pam!packer=7b2a3da7-bd30-4772-a6b0-874aa9b2f3a5"
  insecure = true
}

# Simple test VM
resource "proxmox_virtual_environment_vm" "test_control" {
  name        = "k8s-control-01"
  description = "Test Kubernetes control plane node"
  
  node_name = "node1"
  vm_id     = 130
  
  # Clone from golden image template
  clone {
    vm_id = 9003
  }
  
  # VM resources
  cpu {
    cores = 4
  }
  
  memory {
    dedicated = 8192
  }
  
  # Storage
  disk {
    datastore_id = "rbd"
    interface    = "scsi0"
    size         = 64
  }
  
  # Network
  network_device {
    bridge = "vmbr0"
    model  = "virtio"
  }
  
  # Agent for IP detection
  agent {
    enabled = true
  }
  
  # Start VM after creation
  started = true
}